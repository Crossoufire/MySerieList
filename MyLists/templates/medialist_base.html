{% extends 'layout.html' %}


{% block css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/mymedialist.css') }}">
{% endblock css %}


{% block content %}
    <div class="back-image p-b-15">
        <div class="d-flex flex-wrap center-mobile">
            <div class="m-l-30 m-t-20 icons-mobile">
                <a class="fas fa-lg fa-user m-r-8 return-icon" href="/account/{{ username }}"
                   data-toggle="tooltip" title="{{ username }}" style="color: grey;"></a>
                {% if media_list == 'serieslist' %}
                    <a class="fas fa-lg fa-torii-gate m-r-8 return-icon text-anime" data-toggle="tooltip"
                       href="/animelist/{{ username }}" title="Anime list"></a>
                    <a class="fas fa-lg fa-film m-r-8 return-icon text-movies" data-toggle="tooltip"
                       href="/movieslist/{{ username }}" title="Movies list"></a>
                {% elif media_list == 'animelist' %}
                    <a class="fas fa-lg fa-tv m-r-8 return-icon-tv text-series" data-toggle="tooltip"
                       href="/serieslist/{{ username }}" title="Series list"></a>
                    <a class="fas fa-lg fa-film m-r-8 return-icon text-movies" data-toggle="tooltip"
                       href="/movieslist/{{ username }}" title="Movies list"></a>
                {% elif media_list == 'movieslist' %}
                    <a class="fas fa-lg fa-tv m-r-8 return-icon-tv text-series" data-toggle="tooltip"
                       href="/serieslist/{{ username }}" title="Series list"></a>
                    <a class="fas fa-lg fa-torii-gate m-r-8 return-icon text-anime" data-toggle="tooltip"
                       href="/animelist/{{ username }}" title="Anime list"></a>
                {% endif %}
            </div>
            {% if user_id != current_user.get_id() %}
                <div class="ml-auto m-r-30 m-t-20">
                    <div class="text-center common-media">
                        You share {{ common_elements[0] }}/{{ common_elements[1] }} media ({{ common_elements[2] }}%)
                    </div>
                    <div class="common-media-meter">
                        <span class="common-media-meter-bar" style="width: {{ common_elements[2] }}%;"></span>
                    </div>
                </div>
            {% endif %}
        </div>
        <hr class="header-bar">
        <div class="center-mobile d-flex flex-wrap m-t-20">
            <div class="ml-auto mr-auto">
                <input id="search-input" class="modded-input" placeholder="&#128269; Search..."
                onfocus="this.placeholder = '';" onblur="this.placeholder = '&#128269; Search...';">
                <select id="select-option" class="search-select">
                    <option {% if option == 'title' %}selected="selected"{% endif %} value="title">Title</option>
                    <option {% if option == 'actor' %}selected="selected"{% endif %} value="actor">Actor</option>
                    <option {% if option == 'genre' %}selected="selected"{% endif %} value="genre">Genre</option>
                    {% if media_list == 'movieslist' %}
                        <option {% if option == 'director' %}selected="selected"{% endif %} value="director">Director</option>
                    {% endif %}
                </select>
            </div>
        </div>
        <div class="d-flex flex-wrap" style="justify-content: center;">
            {% block button scoped %}
            {% endblock button %}
        </div>
    </div>
{#    <div class="{% if media_list == 'serieslist' %}bg-series-opa {% elif media_list == 'animelist' %}bg-anime-opa#}
{#    {% else %}bg-movies-opa{% endif %} p-t-4 p-b-4">#}
{#        <div class="mobile-sorting">#}
{#            <label class="m-l-10 mb-0"><b>Sort by:</b></label>#}
{#            <select class="m-l-8 search-select" onchange="sort_medialist(this)">#}
{#                {% block sorting_list scoped %}#}
{#                {% endblock sorting_list %}#}
{#            </select>#}
{#            {% if user_id != current_user.get_id() %}#}
{#                <input id="shared-check" class="m-l-15" type="checkbox" value="{{ filter_val }}"#}
{#                       onclick="filter_medialist()" {% if filter_val == 'check' %}checked {% endif %}>#}
{#                <b> Show Shared</b>#}
{#            {% endif %}#}
{#            <div class="t-pages float-r m-r-10"><b>Total pages: {{ info_pages['total_pages'] }}</b></div>#}
{#        </div>#}
{#    </div>#}

    <nav>
        <div class="mobile-sorting text-right m-t-10">
            {% if user_id != current_user.get_id() %}
                <input id="shared-check" class="m-l-15" type="checkbox" value="{{ filter_val }}"
                       onclick="filter_medialist()" {% if filter_val == 'check' %}checked {% endif %}>
                <b> Show Shared</b>
            {% endif %}
            <li class="nav-item dropdown" style="list-style-type: none; display: inline-block;">
                <a class="nav-link dropdown-toggle" data-toggle="dropdown">genre: {{ genre }}</a>
                <div class="dropdown-menu bg-dark text-light">
                    <a class="dropdown-item" href="/movieslist/Cross/Completed/by/title/page/1">
                        <div>All</div>
                    </a>
                    <a class="dropdown-item" href="/movieslist/Cross/Completed/by/title/page/1">
                        <div>Action</div>
                    </a>
                    <a class="dropdown-item"
                        href="/movieslist/Cross/Completed/genre/Comedy/by/release_date/page/1">
                        <div>Comedy</div>
                    </a>
                    <a class="dropdown-item" href="/movieslist/Cross/Completed/by/rewatch/page/1">
                        <div>Science-Fiction</div>
                    </a>
                    <a class="dropdown-item"
                        href="/movieslist/Cross/Completed/genre/drama/by/release_date/page/1">
                        <div>Drama</div>
                    </a>
                    <a class="dropdown-item"
                       href="/movieslist/Cross/Completed/genre/war/by/release_date/page/1">
                        <div>War</div>
                    </a>
                </div>
            </li>
            <li class="nav-item dropdown" style="list-style-type: none; display: inline-block;">
                <a class="nav-link dropdown-toggle" data-toggle="dropdown">Sort by: {{ sorting|upper }}</a>
                <div class="dropdown-menu bg-dark text-light">
                    <a class="dropdown-item" href="/movieslist/Cross/Completed/by/title/page/1">
                        <div>Title</div>
                    </a>
                    <a class="dropdown-item" href="/movieslist/Cross/Completed/by/score/page/1">
                        <div>Score</div>
                    </a>
                    <a class="dropdown-item" href="/movieslist/Cross/Completed/by/rewatch/page/1">
                        <div>Rewatch</div>
                    </a>
                    <a class="dropdown-item" href="/movieslist/Cross/Completed/by/comment/page/1">
                        <div>Comments</div>
                    </a>
                    <a class="dropdown-item" href="/movieslist/Cross/Completed/by/release_date/page/1">
                        <div>Release date</div>
                    </a>
                </div>
            </li>
        </div>
        <hr style="border-top-color: grey; margin-top: -5px;">
    </nav>

    <ul class="pagination flex-wrap mt-4" style="justify-content: center; font-weight: 400;">
        {% for i in range(info_pages['total_pages']) %}
            <li class="page-item {% if i + 1 == info_pages['actual_page'] %}active {% endif %}">
                <a class="page-link text-light" href="/movieslist/Cross/Completed/sort_by/{{ sorting }}/page/{{ i + 1 }}">
                    {{ '{:02d}'.format(i + 1) }}
                </a>
            </li>
        {% endfor %}
    </ul>

    <h2 class="text-center m-t-30 mb-0">{{ category|upper }} ({{ info_pages['total_media'] }})</h2>
    <hr class="mt-2 pb-3 mb-0">
    <div class="row infinite-scroll-container m-b-60">
        {% for data in media_data  %}
            <div id="card_{{ data['id'] }}" values="{% block data scoped %}{% endblock data %}"
            cat="{{ data['category'] }}" class="card-container col-xl-2 col-lg-2 col-md-3 col-sm-3 col-4">
                <div class="card bg-transparent">
                    <div class="view overlay">
                        <img class="card-img-top" src="{{ data['cover'] }}" height="300" width="200"
                             style="height: auto;" alt=""/>
                        <a class="mask flex-center rgba-black-strong" href="/media_sheet/{{ data['media'] }}/{{ data['id'] }}">
                            <span class="font-mask text-center text-light">{{ data['display_name'] }}</span>
                        </a>
                        {% if search %}
                            <div class="bottom-card-cat{% if media_list =='movieslist' %}-movie {% endif %}">
                                {{ data['category'] }}
                            </div>
                        {% endif %}
                        {% if user_id == current_user.get_id() %}
                            <a class="card-btn-top-left fas fa-bars text-light"
                               onclick="chargeButtons(card_{{ data['id'] }})">
                            </a>
                            <a class="card-btn-toop-right fas fa-trash text-light"
                               onclick="deleteElement(card_{{ data['id'] }}, '{{ media_list }}')">
                            </a>
                        {% else %}
                            {% if data['common'] %}
                                <div class="card-ribbon"></div>
                            {% else %}
                                <a class="card-btn-top-left fas fa-plus text-light"
                                   onclick="ChargeButtonsOther(card_{{ data['id'] }})">
                                </a>
                            {% endif %}
                        {% endif %}
                    </div>
                    <div class="bottom-card-info{% if media_list =='movieslist' %}-movie {% endif %}">
                        <div class="row no-gutters" style="opacity: 0.7;">
                            <div class="col-3" style="padding: 0;">
                                <a class="fa-heart {% if data['favorite'] %} fas favorited {% else %}
                                far {% endif %} {% if user_id != current_user.get_id() %}
                                disabled {% endif %}" data-toggle='tooltip' title="Favorite"
                                   onclick="addFavorite(this,'{{ data['id'] }}','{{ media_list }}')">
                                </a>
                            </div>
                            <div class="col-3" style="padding: 0;">
                                <a id="score_{{ data['id'] }}" class="{% if user_id != current_user.get_id() %}
                                disabled {% endif %}" data-toggle="tooltip" title="Score /10"
                                   onclick="scoreDrop(this, {{ data['id'] }}, '{{ media_list }}')">
                                    {{ data['score'] }}
                                </a>
                            </div>
                            <div class="col-2" style="padding: 0;">
                                <span id="com_{{ data['id'] }}" style="display: none;">{{ data['comment'] }}</span>
                                {% if user_id == current_user.get_id() %}
                                    <a class="fa-comment-alt text-light {% if data['comment'] %} fas commented {% else %}
                                    far {% endif %}" data-toggle='tooltip' title="Comments"
                                    {% if data['comment'] %} onclick="showComment(card_{{ data['id'] }},
                                    '{{ data['media'] }}', '{{ data['id'] }}', true)"
                                    {% else %} href="/comment/{{ data['media'] }}/{{ data['id'] }}"{% endif %}>
                                    </a>
                                {% else %}
                                    <a class="fa-comment-alt text-light {% if data['comment'] %} fas commented {% else %}
                                    far disabled{% endif %}" data-toggle='tooltip' title="Comments"
                                    {% if data['comment'] %} onclick="showComment(card_{{ data['id'] }},
                                    '{{ data['media'] }}', '{{ data['id'] }}', false)"{% endif %}>
                                    </a>
                                {% endif %}
                            </div>
                            <div class="col-4" {% if data['category'] == 'Completed' or data['category'] ==
                             'Completed Animation' %} style="display: block;" {% else %} style="display: none;"{% endif %}>
                                <a id="rew_{{ data['id'] }}" class="{% if user_id != current_user.get_id() %}
                                 disabled {% endif %}" data-toggle="tooltip" title="How many time you rewatched this
                                 media. Do not count the inital completion." onclick="rewatchDrop(this,
                                 {{ data['id'] }}, '{{ media_list }}')">
                                    {{ data['rewatched'] }}
                                </a>
                            </div>
                        </div>
                    </div>
                    {% block seas_eps_drop scoped %}
                    {% endblock seas_eps_drop %}
                </div>
            </div>
        {% endfor %}
    </div>

{#    <div class="scroller-status">#}
{#        <p class="infinite-scroll-error text-center"></p>#}
{#    </div>#}
{#    <p class="pagination end">#}
{#        {% if search %}#}
{#            <a class="pagination__next"#}
{#               href="/{{ media_list }}/{{ username }}?category=Search&query={{ search }}&option={{ option }}&sort={{ sort_val }}&filter={{ filter_val }}&page=2"></a>#}
{#        {% else %}#}
{#            <a class="pagination__next"#}
{#               href="/{{ media_list }}/{{ username }}?category={{ category }}&sort={{ sort_val }}&filter={{ filter_val }}&page=2"></a>#}
{#        {% endif %}#}
{#    </p>#}
{% endblock content %}


{% block script %}
    <script src="https://unpkg.com/infinite-scroll@3/dist/infinite-scroll.pkgd.min.js"></script>
    <script src="{{ url_for('static', filename='js/medialist_base.js') }}"></script>
    <script>
        var input = document.getElementById("search-input");
        input.addEventListener("keyup", function(event) {
            console.log(event);
            if (event.code === 'Enter') {
                event.preventDefault();
                let option_val = document.getElementById("select-option").value;
                let query = input.value;
                if (query === '') {
                } else {
                    window.location.replace('/{{ media_list }}/{{ username }}?category=Search&query='+query +
                    '&option=' + option_val + '&sort={{ sort_val }}&filter={{ filter_val }}')
                }
            }
        });

        function sort_medialist(sort_option) {
            let sort_val = sort_option.value;
            let option_val = document.getElementById("select-option").value;
            {% if search %}
                window.location.replace('/{{ media_list }}/{{ username }}?category=Search&query={{ search }}' +
                '&option='+option_val+'&sort='+sort_val+'&filter={{ filter_val }}');
            {% else %}
                window.location.replace('/{{ media_list }}/{{ username }}?category={{ category }}' +
                '&sort='+sort_val+'&filter={{ filter_val }}');
            {% endif %}
        }

        function filter_medialist() {
            let now = 'check';
            let option_val = document.getElementById("select-option").value;
            if ($('#shared-check').attr('value') === 'check') {
                now = 'not_check';
            }
            {% if search %}
                window.location.replace('/{{ media_list }}/{{ username }}?category=Search&query={{ search }}' +
                '&option='+option_val+'&sort={{ sort_val }}&filter='+now);
            {% else %}
                window.location.replace('/{{ media_list }}/{{ username }}?category={{ category }}' +
                '&sort={{ sort_val }}&filter='+now);
            {% endif %}
        }
    </script>
    {% block javascript scoped %}
    {% endblock javascript %}
{% endblock script %}
