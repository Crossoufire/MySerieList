{% extends "layout.html" %}


{% block css %}
    <link href="{{ url_for('static', filename='css/datatables.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/all_history.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/account.css') }}" rel="stylesheet">
{% endblock css %}


{% block content %}
    <div class="header-container">
        <div class="header-profile-container" {% if user_data['knowledge_info']['frame_level'] < 36 %}
            style="left: -10px; {% endif %}">
            <img class="header-profile-img" src="{{ user_data['profile_picture'] }}"/>
            <img class="header-profile-frame" src="{{ user_data['knowledge_info']['frame_id'] }}.png"/>
            <div class="header-knowledge-level text-center">{{ user_data['knowledge_info']['level'] }}</div>
        </div>
        <div class="header-profile-data"  {% if user_data['knowledge_info']['frame_level'] < 36 %}
            style="left: 200px; {% endif %}">
            <h2 class="profile-name"><b>{{ user_data['username'] }}</b>
                {% if user_data['id'] != current_user.get_id() %}
                    {% if user_data["isfollowing"] %}
                        <button class="btn btn-sm btn-dark follow-btn"
                                onclick="follow_status('{{ user_data['id'] }}')">Unfollow</button>
                    {% else %}
                        <button class="btn btn-sm btn-primary follow-btn"
                                onclick="follow_status('{{ user_data['id'] }}')">Follow</button>
                    {% endif %}
                {% endif %}
            </h2>
            <div>
                <b>Joined: {{ user_data['register'] }}</b><br>
                <b>Followers: {{ user_data['followers'] }}</b>
            </div>
        </div>
        <div class="header-profile-data-mobile">
            <h4 class="p-0 m-0"><b>{{ user_data['username'] }}</b></h4>
            <div class="header-join-follow">
                <b>Joined: {{ user_data['register'] }}</b><br>
                <b>Followers: {{ user_data['followers'] }}</b>
            </div>
        </div>
    </div>
    <h4><i class="fas fa-highlighter m-t-15"></i>&nbsp&nbspAll Updates</h4>
    <hr>
    <a class="text-light" href="/account/{{ user_data['username'] }}">
        <i class="fas fa-caret-left"></i>&nbsp&nbsp <b>Return to account</b>
    </a>
    <div class="all_history ml-auto mr-auto" style="margin-top: -13px;">
        <table id="all_history" class="table text-light m-t-20 text-center ml-auto mr-auto">
            <thead>
                <tr>
                    <th>Media type</th>
                    <th>Media name</th>
                    <th>Update</th>
                    <th>date</th>
                </tr>
            </thead>
            <tbody>
                {% for update in media_updates %}
                    <tr>
                        <td>
                            {% if update['category'] == 'movie' %}
                                <i class="fas fa-2x fa-film" style="color: #8c7821;"></i>
                            {% elif update['category'] == 'anime' %}
                                <i class="fas fa-2x fa-torii-gate" style="color: #945141;"></i>
                            {% else %}
                                <i class="fas fa-2x fa-tv" style="color: #216e7d;"></i>
                            {% endif %}
                        </td>
                        <td>{{ update['media_name'] }}</td>
                        <td>
                            {% if update['update']|length == 2 %}
                                {{ update['update'][0] }}
                                &nbsp;&nbsp;<i class="fas fa-long-arrow-alt-right"></i>&nbsp;&nbsp;
                                {{ update['update'][1] }}</td>
                            {% else %}
                                {{ update['update'][0] }}
                            {% endif %}
                        <td>
                           <script>
                                var tz = new Intl.DateTimeFormat().resolvedOptions().timeZone;
                                var localdate = new Date("{{ update['date'] }}").toLocaleString("en-GB", {timeZone: tz});
                                var d = new Date("{{ update['date'] }}")
                                var month = new Array();
                                month[0] = "Jan";
                                month[1] = "Feb";
                                month[2] = "Mar";
                                month[3] = "Apr";
                                month[4] = "May";
                                month[5] = "Jun";
                                month[6] = "Jul";
                                month[7] = "Aug";
                                month[8] = "Sep";
                                month[9] = "Oct";
                                month[10] = "Nov";
                                month[11] = "Dec";
                                var date_month = month[d.getMonth()];
                                var date_day = localdate.slice(0,2);
                                var date_time = localdate.slice(11,17)
                                document.write(date_day + " " + date_month + " at " + date_time)
                            </script>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock content %}


{% block script %}
    <script type="text/javascript" src="{{ url_for('static', filename='js/datatables.min.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/all_history.js') }}"></script>
{% endblock script %}
