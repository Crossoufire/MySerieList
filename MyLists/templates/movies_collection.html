{% extends 'layout.html' %}


{% block css %}
    <link href="{{ url_for('static', filename='css/mymedialist.css') }}" rel="stylesheet">
    <style>
        .card-body {
            border-bottom: solid black 1px;
            border-right: solid black 1px;
            border-left: solid black 1px;
        }

        .number-seen {
            position: absolute;
            bottom: 1px;
            right: 1px;
            border-right: black 1px;
            border-bottom: black 1px;
            background: #131418;
            padding-left: 12px;
            padding-right: 12px;
            font-size: 14pt;
        }
    </style>
{% endblock css %}


{% block content %}
    <div class="back-image p-b-15">
        <div class="d-flex flex-wrap center-mobile">
            <div class="m-l-30 m-t-20 icons-mobile">
                <a class="fas fa-lg fa-user m-r-8 return-icon"
                   href="{{ url_for('users.account', user_name=username) }}" data-toggle="tooltip"
                   title="{{ username }}" style="color: grey;"></a>
                {% if media_list == 'serieslist' %}
                    <a class="fas fa-lg fa-torii-gate m-r-8 return-icon" href="/animelist/{{ username }}"
                       data-toggle="tooltip" title="Anime list" style="color: #945141;"></a>
                    <a class="fas fa-lg fa-film m-r-8 return-icon" href="/movieslist/{{ username }}"
                       data-toggle="tooltip" title="Movies list" style="color: #8c7821;"></a>
                {% elif media_list == 'animelist' %}
                    <a class="fas fa-lg fa-tv m-r-8 return-icon-tv" href="/serieslist/{{ username }}"
                       data-toggle="tooltip" title="Series list" style="color: #216e7d;"></a>
                    <a class="fas fa-lg fa-film m-r-8 return-icon" href="/movieslist/{{ username }}"
                       data-toggle="tooltip" title="Movies list" style="color: #8c7821;"></a>
                {% else %}
                    <a class="fas fa-lg fa-tv m-r-8 return-icon-tv" href="/serieslist/{{ username }}"
                       data-toggle="tooltip" title="Series list" style="color: #216e7d;"></a>
                    <a class="fas fa-lg fa-torii-gate m-r-8 return-icon" href="/animelist/{{ username }}"
                       data-toggle="tooltip" title="Anime list" style="color: #945141;"></a>
                {% endif %}
            </div>
        </div>
        <hr class="header-bar m-l-20 m-r-20 m-t-15">
        <div class="center-mobile d-flex flex-wrap m-t-20">
            <div class="ml-auto mr-auto">
                <i class="fas fa-search text-dark" style="text-shadow: 0 0 0 #000 !important;"></i>
                <label for="searchInput"></label>
                <input id="searchInput" class='modded-input text-light' placeholder="Search by title"
                       onkeyup="searchElement()">
            </div>
        </div>
        <div class="center-mobile d-flex flex-wrap filters-button-group m-t-10">
            <button class="btn btn-sm btn-selected" data-filter="*">Show all</button>
            <button class="btn btn-sm btn-header" data-filter=".categories.COMPLETED">Completed</button>
            <button class="btn btn-sm btn-header" data-filter=".categories.ON.GOING">On Going</button>
        </div>
    </div>
    <div id="categories-iso" class="row categories-iso">
        <div class="categories COMPLETED">
            <h2 class="text-center m-t-30 mb-0" style="width: 100%;">COMPLETED COLLECTIONS ({{ length_completed }})</h2>
            <hr class="mt-2 pb-3 mb-0">
            <div class="row category-COMPLETED">
                {% for movie in completed_collections %}
                    <div class="card-container col-xl-2 col-lg-2 col-md-3 col-sm-3 col-4">
                        <div class="card bg-transparent">
                            <div class="view overlay">
                                <img class="card-img-top lazyload" data-src="{{ movie['poster'] }}" height="300"
                                     width="200" style="height: auto;">
                                <div class="mask flex-center rgba-black-strong">
                                    <span class="font-mask text-center text-light">{{ movie['name'] }}</span>
                                    <span class="by-original-title" style="display: none;">{{ movie['name'] }}</span>
                                </div>
                            </div>
                            <div class="number-seen">
                                <span>{{ movie['parts'] }}/{{ movie['total'] }}</span>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
        <div class="categories ON GOING">
            <h2 class="text-center m-t-30 mb-0" style="width: 100%;">ON GOING COLLECTIONS ({{ length_ongoing }})</h2>
            <hr class="mt-2 pb-3 mb-0">
            <div class="row category-ON GOING">
                {% for movie in ongoing_collections %}
                    <div class="card-container col-xl-2 col-lg-2 col-md-3 col-sm-3 col-4">
                        <div class="card bg-transparent">
                            <div class="view overlay">
                                <img class="card-img-top lazyload" data-src="{{ movie['poster'] }}" height="300"
                                     width="200" style="height: auto;">
                                <div class="mask flex-center rgba-black-strong">
                                    <span class="font-mask text-center text-light">{{ movie['name'] }}</span>
                                    <span class="by-original-title" style="display: none;">{{ movie['name'] }}</span>
                                </div>
                            </div>
                            <div class="number-seen">
                                <span>{{ movie['parts'] }}/{{ movie['total'] }}</span>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
{% endblock content %}


{% block script %}
    <script src="https://unpkg.com/isotope-layout@3/dist/isotope.pkgd.min.js"></script>
    <script>
        // --- Tooltip ---------------------------------------------------------
        $(document).ready(function () {
            $body = $("body");
            $body.tooltip();
            $(function () {
                $('[data-toggle="tooltip"]').tooltip()
            })
        });

        // --- Isotopes --------------------------------------------------------
        let $categories = $('.categories-iso').isotope({
            itemSelector: '.categories',
            layoutMode: 'vertical',
            onLayout: function () {
                $window.trigger("scroll");
            }
        });
        $("img.lazyload").lazyload({
            failure_limit: Math.max($("img.lazyload").length - 1, 0)
        });

        $('.filters-button-group').on('click', 'button', function () {
            var filterValue = $(this).attr('data-filter');
            $categories.isotope({filter: filterValue});
        });

        $('.filters-button-group').each(function (i, buttonGroup) {
            var $buttonGroup = $(buttonGroup);
            $buttonGroup.on('click', 'button', function () {
                $buttonGroup.find('.btn-selected').addClass('btn-header');
                $buttonGroup.find('.btn-selected').removeClass('btn-selected');
                $(this).addClass('btn-selected');
                $(this).removeClass('btn-header');
            });
        });
        $categories.isotope('layout');

        // --- Row gutters -----------------------------------------------------
        (function ($) {
            var $window = $(window),
                $row = $('.row');

            function resize() {
                if ($window.width() < 1025) {
                    return $row.addClass('no-gutters');
                }
                $row.removeClass('no-gutters');
            }

            $window.resize(resize).trigger('resize');
            $categories.isotope('layout');
        })(jQuery);

        $categories.isotope('layout');

        // --- Search by Collection Title --------------------------------------
        function searchElement() {
            let input, filter, cards, cardContainer, title, i, l;
            input = document.getElementById("searchInput");
            filter = input.value.toUpperCase();
            cardContainer = document.getElementById("categories-iso");
            cards = cardContainer.getElementsByClassName("card-container");
            l = cards.length;
            for (i = 0; i < l; i++) {
                title = cards[i].querySelector(".font-mask");
                original_title = cards[i].querySelector(".by-original-title");
                if (original_title.innerText.toUpperCase().indexOf(filter) > -1) {
                    cards[i].style.display = "";
                } else {
                    cards[i].style.display = "none";
                }
            }

            $categories.isotope('layout');
        }
    </script>
{% endblock script %}
