{% extends "layout.html" %}


{% block css %}
<style>
.modal-content {
    background: #131418;
}

.form-control {
    background: transparent;
    border-radius: 0px;
    border-top: 0px;
    border-left: 0px;
    border-right: 0px;
    color: #fff;
}

.form-control:focus {
    background: transparent;
    border-radius: 0px;
    border-top: 0px;
    border-left: 0px;
    border-right: 0px;
    box-shadow: 0 0 0 0rem;
    color: #fff;
}

hr {
    border-top: 1px solid rgba(255, 255, 255, 0.9);
}

.table {
  color: #fff
}

.form_account {
    max-width: 800px;
}

.small {
    padding-top: 5px !important;
    padding-bottom: 5px !important;
    padding-left: 10px !important;
    padding-right: 10px !important;
}

.arrow_div {
    height: 21px;
    width: 21px;
}

.block:nth-of-type(2) {
	background-color: #45B29D;
}

.block:nth-of-type(3) {
	background-color: #EFC94C;
}

.block:nth-of-type(4) {
	background-color: #E27A3F;
}
.block:nth-of-type(5) {
	background-color: #DF5A49;
}

.block:nth-of-type(6) {
	background-color: #962D3E;
}

.block:hover {
	opacity: 0.75;
}

.col-centered{
    float: none;
    margin: 0 auto;
}

/* On screens that are 599px or more */
@media screen and (min-width: 599px) {
    .account-img {
        height: 200px;
        width: 200px;
        margin-bottom: 15px;
        border-style: solid;
        border-width: 1px;
    }

    .border_account {
        border-style: solid;
        border-width: 2px;
        border-color: grey;
        border-radius: 10px;
        padding-top: 30px;
        padding-bottom: 20px;
        padding-left: 50px;
        padding-right: 50px;
        margin-bottom: 20px;
    }

    .stat_text {
        font-size: 12pt;
    }

    .mini {
        min-width: 105px;
    }

    .block {
	    height: 30px;
	    color: #fff;
	    float: left;
	    background-color: #334D5C;
    }
}

/* On screens that are 599px or less */
@media screen and (max-width: 599px) {
    .account-img {
        height: 100px;
        width: 100px;
        margin-bottom: 15px;
        border-style: solid;
        border-width: 1px;
    }

    .btn.btn-sm {
        padding: .5rem 1rem;
        font-size: .4rem;
    }

    .border_account {
        border-style: solid;
        border-width: 2px;
        border-color: grey;
        border-radius: 10px;
        padding-top: 30px;
        padding-bottom: 20px;
        padding-left: 20px;
        padding-right: 20px;
        margin-bottom: 20px;
    }

    .username {
        font-size: 1.5rem;
    }

    .stat_text {
        font-size: 10pt;
    }

    .mini {
        min-width: 100px;
    }

    .block {
	    height: 25px;
	    color: #fff;
	    float: left;
	    background-color: #334D5C;
    }

    .position {
        text-align: right;
    }
}

.table tr {
    text-align: center;
    vertical-align: middle;
}

.table td {
    text-align: center;
    vertical-align: middle;
}

.container-friends {
    max-width: 650px;
    margin-right: auto;
    margin-left: auto;
}
</style>
{% endblock css %}


{% block content %}
<div class="container form_account p-0">
    <!--------- Add friend modal ---------->
    <div class="modal fade" id="addFriendModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content" style="border-style: solid; border-width: 1px; border-color: white; max-width: 300px; margin-left: auto; margin-right: auto;">
                <form method="POST" action="">
                    {{ form.hidden_tag() }}
                    <h5 class="border-bottom p-t-20 p-b-15 text-center"><b>Add a Friend</b></h5>
                    <div class="form-group m-l-40 m-r-40 m-t-15">
                        {% if form.add_friend.errors %}
                            {{ form.add_friend(class="form-control form-control is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.add_friend.errors %}
                                    <span>{{ error }}</span> {% endfor %}
                            </div>
                        {% else %}
                            {{ form.add_friend(class="form-control", placeholder="Username", onfocus="this.value=''") }}
                        {% endif %}
                    </div>
                    <div class="form-group m-l-20 m-r-20 text-center">
                        {{ form.submit(class="btn btn-sm btn-outline-info") }}
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!------------------------------------->

    <div class="border_account">
        <!----------------- Account picture/Username/email/account settings ----------------->
        <div class="d-flex flex-wrap">
            <div class="p-r-10 bd-highlight">
                <img class="rounded border-light account-img" src="{{ profile_picture }}">
            </div>
            <div class="bd-highlight">
                <h2 class="mt-0 account-heading username">{{ current_user.username }}</h2>
                <h5 class="text">{{ current_user.email }}</h5>
            </div>
            <div class="ml-auto bd-highlight">
                <a class="btn btn-sm bg-dark m-0" href="{{ url_for('account_settings') }}" role="button">
                    <i class="fa fa-cog fa-2x fa-fw"></i>
                </a>
            </div>
        </div>
        <!----------------------------------------------------------------------------------->

        <h3 class="font-weight-light text-center mt-4 mb-0">
            <div class="arrow_div float-left">
                <a class="fas fa-xs fa-user-plus" data-toggle="modal" data-target="#addFriendModal"></a>
            </div>
            Friends
            <div class="arrow_div float-right">
                <a class="fas fa-xs fa-chevron-down" id="FRIENDS_arrow" onclick="hide_friends('FRIENDS', 'FRIENDS_arrow')"></a>
            </div>
        </h3>

        <hr class="mt-2 mb-3">

        <div class="container-friends">
            <div id="FRIENDS" class="row" style="margin-right: 0px; margin-left: 0px;">
                <table class="table table-striped table-sm table-responsive-lg" cellspacing="0" width="100%">
                    {% for friend in friends_list_data %}
                        {% if friend['status'] == "pending" %}
                            <tr>
                                <td><a class="text-light" href="#" id="{{ friend['user_id'] }}">{{ friend['username'] }}</a>
                                    <button class="btn btn-sm btn-danger small" style="float: right; margin-top: 0px; margin-bottom: 0px;" id="decline_{{ friend['user_id'] }}">Decline</button>
                                    <button class="btn btn-sm btn-mdb-color small" style="float: right; margin-top: 0px; margin-bottom: 0px;" id="accept_{{ friend['user_id'] }}">Accept</button>
                                </td>
                            </tr>
                        {% elif friend['status'] == "request" %}
                            <tr>
                                <td><a class="text-light" href="#">{{ friend['username'] }} (Pending request)</a>
                                    <button type="button" id="C_{{ friend['user_id'] }}" class="close text-light" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </td>
                            </tr>
                        {% elif friend['status'] == "declined" %}
                        {% else %}
                            <tr>
                                <td>
                                    <a class="disabled text-light">{{ friend['username'] }}</a>
                                </td>
                                <td>
                                    <a class="text-light" href="/user/series/{{ friend['username'] }}">SeriesList</a>
                                </td>
                                <td>
                                    <a class="text-light" href="/user/anime/{{ friend['username'] }}">AnimeList</a>
                                </td>
                                <td>
                                    <button type="button" id="C_{{ friend['user_id'] }}" class="close text-light" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                </table>
            </div>
        </div>

        <h3 class="font-weight-light text-center mt-4 mb-0">
            Series Statistics
            <div class="arrow_div float-right">
                <a class="fas fa-xs fa-chevron-down" id="SERIES_arrow" onclick="hide('SERIES', 'SERIES_arrow')"></a>
            </div>
        </h3>

        <hr class="mt-2 mb-3">

        <div id="SERIES" class="container-stats">
            <div class="m-b-10">
                <span class="stat_text"><b>Days:</b> {{ total_time_series[2] }}</span>
                <span class="stat_text float-right"><b>Hours:</b> {{ total_time_series[1] }}</span>
            </div>

            <figure class="d-flex">
                <span class="block" title="Watching">
                    <span id="{{ series_rate[0] }}%" class="value"></span>
                </span>
                <span class="block" title="Completed">
                    <span id="{{ series_rate[1] }}%" class="value"></span>
                </span>
                <span class="block" title="On Hold">
                    <span id="{{ series_rate[2] }}%" class="value"></span>
                </span>
                <span class="block" title="Random">
                    <span id="{{ series_rate[3] }}%" class="value"></span>
                </span>
                <span class="block" title="Dropped">
                    <span id="{{ series_rate[4] }}%" class="value"></span>
                </span>
                <span class="block" title="Plan to Watch">
                    <span id="{{ series_rate[5] }}%" class="value"></span>
                </span>
            </figure>

            <div class="m-t-10">
                <div class="row">
                    <div class="col mini p-r-0">
                        <span class="stat_text">Watching:</span>
                    </div>
                    <div class="col p-0 position">
                        <span class="stat_text">{{ nb_of_series[0] }}</span>
                    </div>
                    <div class="col mini p-r-0">
                        <span class="stat_text">Dropped:</span>
                    </div>
                    <div class="col p-l-0 position">
                        <span class="stat_text">{{ nb_of_series[4] }}</span>
                    </div>
                </div>

                <div class="row">
                    <div class="col mini p-r-0">
                        <span class="stat_text">Completed:</span>
                    </div>
                    <div class="col p-0 position">
                        <span class="stat_text">{{ nb_of_series[1] }}</span>
                    </div>
                    <div class="col mini p-r-0">
                        <span class="stat_text">Plan to Watch:</span>
                    </div>
                    <div class="col p-l-0 position">
                        <span class="stat_text">{{ nb_of_series[5] }}</span>
                    </div>
                </div>

                <div class="row">
                    <div class="col mini p-r-0">
                        <span class="stat_text">On Hold:</span>
                    </div>
                    <div class="col p-0 position">
                        <span class="stat_text">{{ nb_of_series[2] }}</span>
                    </div>
                    <div class="col mini p-r-0">
                        <span class="stat_text"></span>
                    </div>
                    <div class="col p-l-0 position">
                        <span class="stat_text"></span>
                    </div>
                </div>

                <div class="row">
                    <div class="col mini p-r-0">
                        <span class="stat_text">Random:</span>
                    </div>
                    <div class="col p-0 position">
                        <span class="stat_text">{{ nb_of_series[3] }}</span>
                    </div>
                    <div class="col mini p-r-0">
                        <span class="stat_text">Episodes:</span>
                    </div>
                    <div class="col p-l-0 position">
                        <span class="stat_text">{{ total_time_series[0] }}</span>
                    </div>
                </div>
            </div>
        </div>

        <h3 class="font-weight-light text-center mt-5 mb-0">
            Anime Statistics
            <div class="arrow_div float-right">
                <a class="fas fa-xs fa-chevron-down" id="ANIME_arrow" onclick="hide('ANIME', 'ANIME_arrow')"></a>
            </div>
        </h3>

        <hr class="mt-2 mb-3">

        <div id="ANIME" class="container-stats">
            <div class="m-b-10">
                <span class="stat_text"><b>Days:</b> {{ total_time_animes[2] }}</span>
                <span class="stat_text float-right"><b>Hours:</b> {{ total_time_animes[1] }}</span>
            </div>

            <figure class="d-flex">
                <span class="block" title="Watching">
                    <span id="{{ anime_rate[0] }}%" class="value"></span>
                </span>
                <span class="block" title="Completed">
                    <span id="{{ anime_rate[1] }}%" class="value"></span>
                </span>
                <span class="block" title="On Hold">
                    <span id="{{ anime_rate[2] }}%" class="value"></span>
                </span>
                <span class="block" title="Random">
                    <span id="{{ anime_rate[3] }}%" class="value"></span>
                </span>
                <span class="block" title="Dropped">
                    <span id="{{ anime_rate[4] }}%" class="value"></span>
                </span>
                <span class="block" title="Plan to Watch">
                    <span id="{{ anime_rate[5] }}%" class="value"></span>
                </span>
            </figure>

            <div class="m-t-10">
                <div class="row">
                    <div class="col mini p-r-0">
                        <span class="stat_text">Watching:</span>
                    </div>
                    <div class="col p-0 position">
                        <span class="stat_text">{{ nb_of_animes[0] }}</span>
                    </div>
                    <div class="col mini p-r-0">
                        <span class="stat_text">Dropped:</span>
                    </div>
                    <div class="col p-l-0 position">
                        <span class="stat_text">{{ nb_of_animes[4] }}</span>
                    </div>
                </div>

                <div class="row">
                    <div class="col mini p-r-0">
                        <span class="stat_text">Completed:</span>
                    </div>
                    <div class="col p-0 position">
                        <span class="stat_text">{{ nb_of_animes[1] }}</span>
                    </div>
                    <div class="col mini p-r-0">
                        <span class="stat_text">Plan to Watch:</span>
                    </div>
                    <div class="col p-l-0 position">
                        <span class="stat_text">{{ nb_of_animes[5] }}</span>
                    </div>
                </div>

                <div class="row">
                    <div class="col mini p-r-0">
                        <span class="stat_text">On Hold:</span>
                    </div>
                    <div class="col p-0 position">
                        <span class="stat_text">{{ nb_of_animes[2] }}</span>
                    </div>
                    <div class="col mini p-r-0">
                        <span class="stat_text"></span>
                    </div>
                    <div class="col p-l-0 position">
                        <span class="stat_text"></span>
                    </div>
                </div>

                <div class="row">
                    <div class="col mini p-r-0">
                        <span class="stat_text">Random:</span>
                    </div>
                    <div class="col p-0 position">
                        <span class="stat_text">{{ nb_of_animes[3] }}</span>
                    </div>
                    <div class="col mini p-r-0">
                        <span class="stat_text">Episodes:</span>
                    </div>
                    <div class="col p-l-0 position">
                        <span class="stat_text">{{ total_time_animes[0] }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}


{% block script %}
<script>
function hide(category, arrow) {
    var category = document.getElementById(category);
    var arrow = document.getElementById(arrow);

    if (category.className === "container-stats"){
        category.className = "d-none";
        arrow.className = "fas fa-xs fa-chevron-right";
    } else {
        category.className = "container-stats";
        arrow.className = "fas fa-xs fa-chevron-down";
    }
}

function hide_friends(category, arrow) {
    var category = document.getElementById(category);
    var arrow = document.getElementById(arrow);

    if (category.className === "row"){
        category.className = "d-none";
        arrow.className = "fas fa-xs fa-chevron-right";
    } else {
        category.className = "row";
        arrow.className = "fas fa-xs fa-chevron-down";
    }
}

{% for friend in friends_list_data %}
    let close_{{ friend['user_id'] }} = document.getElementById("C_{{ friend['user_id'] }}");
    {% if friend['status'] == "pending" %}
        let accept_{{ friend['user_id'] }} = document.getElementById("accept_{{ friend['user_id'] }}");
        let decline_{{ friend['user_id'] }} = document.getElementById("decline_{{ friend['user_id'] }}");

        accept_{{ friend['user_id'] }}.onclick = function () {
            $.ajax ({
                type: "POST",
                url: "/accept_friend_request",
                contentType: "application/json",
                data: JSON.stringify({reponse: {{ friend['user_id'] }} }),
                dataType: "json",
                success: function(response) {
                    window.location.replace('/account'); }
            });
        }

        decline_{{ friend['user_id'] }}.onclick = function () {
            $.ajax ({
                type: "POST",
                url: "/decline_friend_request",
                contentType: "application/json",
                data: JSON.stringify({reponse: {{ friend['user_id'] }} }),
                dataType: "json",
                success: function(response) {
                    window.location.replace('/account'); }
            });
        }
    {% else %}

    close_{{ friend['user_id'] }}.onclick = function () {
        $.ajax ({
            type: "POST",
            url: "/delete_friend",
            contentType: "application/json",
            data: JSON.stringify({delete: {{ friend['user_id'] }} }),
            dataType: "json",
            success: function(response) {
                window.location.replace('/account'); }
        });
    }
    {% endif %}
{% endfor %}
</script>
<script>
$('.value').each(function() {
	var text = $(this).attr('id');
    $(this).parent().css('width', text);
});
$('.block').tooltip();
</script>
{% endblock %}
