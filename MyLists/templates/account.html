{% extends "layout.html" %}

{% block css %}
<style>
.modal-content {
    background: #131418;
}

.form-control {
    background: transparent;
    border-radius: 0px;
    border-top: 0px;
    border-left: 0px;
    border-right: 0px;
    color: #fff;
}

.form-control:focus {
    background: transparent;
    border-radius: 0px;
    border-top: 0px;
    border-left: 0px;
    border-right: 0px;
    box-shadow: 0 0 0 0rem;
    color: #fff;
}

.account-img {
    height: 200px;
    width: 200px;
    margin-bottom: 15px;
    border-style: solid;
    border-width: 1px;
}

hr {
    border-top: 1px solid rgba(255, 255, 255, 0.9);
}

.btn_settings {
    border-style: solid !important;
    border-width: 1px !important;
    border-color: black !important;
    border-radius: 1px !important;
}

.table {
  color: #fff
}

#add_friend {
    padding-top: 5px !important;
    padding-bottom: 5px !important;
    padding-left: 10px !important;
    padding-right: 10px !important;
}

.btn_setting {
    margin: 0px;
}

.form_account {
    max-width: 800px;
}

.small {
    padding-top: 5px !important;
    padding-bottom: 5px !important;
    padding-left: 10px !important;
    padding-right: 10px !important;
}
</style>
{% endblock css %}

{% block content %}
<!-- Add friend modal -->
<div class="container form_account">
    <div class="modal fade" id="addFriendModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content" style="border-style: solid; border-width: 1px; border-color: white; max-width: 300px; margin-left: auto; margin-right: auto;">
                <form method="POST" action="">
                    {{ form.hidden_tag() }}
                    <fieldset class="form-group">
                        <h5 class="border-bottom p-t-10 p-b-10 text-center"><b>Add a Friend</b></h5>
                        <div class="form-group m-l-20 m-r-20">
                            {% if form.add_friend.errors %}
                            {{ form.add_friend(class="form-control form-control is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.add_friend.errors %}
                                <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                            {% else %}
                            {{ form.add_friend(class="form-control", placeholder="Username", onfocus="this.value=''") }}
                            {% endif %}
                        </div>
                    </fieldset>
                    <div class="form-group m-l-20 m-r-20 text-center">
                        {{ form.submit(class="btn btn-outline-info") }}
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="d-flex flex-wrap-reverse">
        <div class="p-r-10 bd-highlight">
            <img class="rounded border-light account-img" src="{{ profile_picture }}">
        </div>
        <div class="bd-highlight">
            <h2 class="mt-0 account-heading">{{ current_user.username }}</h2>
            <h5 class="text">{{ current_user.email }}</h5>
        </div>
        <div class="ml-auto bd-highlight">
            <a class="btn btn-sm bg-dark btn_setting" href="{{ url_for('account_settings') }}" role="button">
                <i class="fa fa-cog fa-2x fa-fw"></i>
            </a>
        </div>
    </div>

    <h2 class="font-weight-light text-center mt-4 mb-0">Series Statistics</h2>
    <hr class="mt-2 mb-3">

    <div class="row">
        <div class="col-sm">
            <table class="table table-striped table-dark table-sm">
                <thead>
                    <tr>
                        <th scope="col" class="text-center">Category</th>
                        <th scope="col" class="text-center">#Series</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Watching</td>
                        <td class="text-center">{{ nb_of_series[0] }}</td>
                    </tr>
                    <tr>
                        <td>Completed</td>
                        <td class="text-center">{{ nb_of_series[1] }}</td>
                    </tr>
                    <tr>
                        <td>On Hold</td>
                        <td class="text-center">{{ nb_of_series[2] }}</td>
                    </tr>
                    <tr>
                        <td>Random</td>
                        <td class="text-center">{{ nb_of_series[3] }}</td>
                    </tr>
                    <tr>
                        <td>Dropped</td>
                        <td class="text-center">{{ nb_of_series[4] }}</td>
                    </tr>
                    <tr>
                        <td>Plan To Watch</td>
                        <td class="text-center">{{ nb_of_series[5] }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="col-sm">
            <table class="table table-striped table-dark table-sm">
                 <thead>
                    <th scope="col" class="text-center">Statistics</th>
                    <th scope="col" class="text-center">Data</th>
                </thead>
                <tbody>
                    <tr>
                        <td>Episodes Watched</td>
                        <td class="text-center">{{ total_time_series[0] }}</td>
                    </tr>
                    <tr>
                        <td>Time Spent in Hours</td>
                        <td class="text-center">{{ total_time_series[1] }}</td>
                    </tr>
                    <tr>
                        <td>Time Spent in Days</td>
                        <td class="text-center">{{ total_time_series[2] }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="col-sm">
            <table class="table table-striped table-dark table-sm">
                 <thead>
                    <th scope="col" class="text-center">Friends
                        <a id="add_friend" class="btn btn-sm btn-light text-dark float-right" data-toggle="modal" data-target="#addFriendModal">Add</a>
                    </th>
                </thead>
                {% for friend in friends_list_data %}
                    {% if friend['status'] == "pending" %}
                        <tr>
                            <td><a class="text-light" href="#" id="{{ friend['user_id'] }}">{{ friend['username'] }}</a>
                                <button class="btn btn-sm btn-mdb-color small" id="accept_{{ friend['user_id'] }}">Accept</button>
                                <button class="btn btn-sm btn-danger small" id="decline_{{ friend['user_id'] }}">Decline</button>
                            </td>
                        </tr>
                    {% elif friend['status'] == "request" %}
                        <tr>
                            <td><a class="text-light" href="#">{{ friend['username'] }} (Pending request)</a>
                                <button type="button" id="C_{{ friend['user_id'] }}" class="close text-light" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </td>
                        </tr>

                    {% elif friend['status'] == "declined" %}
                    {% else %}
                        <tr>
                            <td>
                                <a class="text-light" href="/user/{{ friend['username'] }}">{{ friend['username'] }}</a>
                                <button type="button" id="C_{{ friend['user_id'] }}" class="close text-light" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </td>
                        </tr>
                    {% endif %}
                {% endfor %}
            </table>
        </div>
    </div>


    <h2 class="font-weight-light text-center mt-4 mb-0">Anime Statistics</h2>
    <hr class="mt-2 mb-3">

    <div class="row">
        <div class="col-sm">
            <table class="table table-striped table-dark table-sm">
                <thead>
                    <tr>
                        <th scope="col" class="text-center">Category</th>
                        <th scope="col" class="text-center">#Animes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Watching</td>
                        <td class="text-center">{{ nb_of_animes[0] }}</td>
                    </tr>
                    <tr>
                        <td>Completed</td>
                        <td class="text-center">{{ nb_of_animes[1] }}</td>
                    </tr>
                    <tr>
                        <td>On Hold</td>
                        <td class="text-center">{{ nb_of_animes[2] }}</td>
                    </tr>
                    <tr>
                        <td>Random</td>
                        <td class="text-center">{{ nb_of_animes[3] }}</td>
                    </tr>
                    <tr>
                        <td>Dropped</td>
                        <td class="text-center">{{ nb_of_animes[4] }}</td>
                    </tr>
                    <tr>
                        <td>Plan To Watch</td>
                        <td class="text-center">{{ nb_of_animes[5] }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="col-sm">
            <table class="table table-striped table-dark table-sm">
                 <thead>
                    <th scope="col" class="text-center">Statistics</th>
                    <th scope="col" class="text-center">Data</th>
                </thead>
                <tbody>
                    <tr>
                        <td>Episodes Watched</td>
                        <td class="text-center">{{ total_time_animes[0] }}</td>
                    </tr>
                    <tr>
                        <td>Time Spent in Hours</td>
                        <td class="text-center">{{ total_time_animes[1] }}</td>
                    </tr>
                    <tr>
                        <td>Time Spent in Days</td>
                        <td class="text-center">{{ total_time_animes[2] }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

<!--    <h2 class="font-weight-light text-center mt-4 mb-0">Series Graphics</h2>
    <hr class="mt-2 mb-2">

    <canvas class="chart m-b-20 m-t-20" id="mixedChart"></canvas>-->

</div>

<script>
{% for friend in friends_list_data %}
    let close_{{ friend['user_id'] }} = document.getElementById("C_{{ friend['user_id'] }}");
    {% if friend['status'] == "pending" %}
        let accept_{{ friend['user_id'] }} = document.getElementById("accept_{{ friend['user_id'] }}");
        let decline_{{ friend['user_id'] }} = document.getElementById("decline_{{ friend['user_id'] }}");

        accept_{{ friend['user_id'] }}.onclick = function () {

            $.ajax ({
                type: "POST",
                url: "/accept_friend_request",
                contentType: "application/json",
                data: JSON.stringify({reponse: {{ friend['user_id'] }} }),
                dataType: "json",
                success: function(response) {
                    window.location.replace('/account'); }
            });
        }

        decline_{{ friend['user_id'] }}.onclick = function () {

            $.ajax ({
                type: "POST",
                url: "/decline_friend_request",
                contentType: "application/json",
                data: JSON.stringify({reponse: {{ friend['user_id'] }} }),
                dataType: "json",
                success: function(response) {
                    window.location.replace('/account'); }
            });
        }
    {% else %}

    close_{{ friend['user_id'] }}.onclick = function () {

        $.ajax ({
            type: "POST",
            url: "/delete_friend",
            contentType: "application/json",
            data: JSON.stringify({delete: {{ friend['user_id'] }} }),
            dataType: "json",
            success: function(response) {
                window.location.replace('/account'); }
        });
    }
    {% endif %}
{% endfor %}
</script>
{% endblock content %}

{% block script %}
<script>
/* var ctx = document.getElementById("mixedChart").getContext('2d');
var myChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
        datasets: [{
            type: "bar",
            label: 'Episodes viewed per month this year',
            data: {{ nb_episodes_watched }},
            backgroundColor: [
                'rgba(185, 75, 100, 0.7)',
                'rgba(185, 75, 100, 0.7)',
                'rgba(185, 75, 100, 0.7)',
                'rgba(185, 75, 100, 0.7)',
                'rgba(185, 75, 100, 0.7)',
                'rgba(185, 75, 100, 0.7)',
                'rgba(185, 75, 100, 0.7)',
                'rgba(185, 75, 100, 0.7)',
                'rgba(185, 75, 100, 0.7)',
                'rgba(185, 75, 100, 0.7)',
                'rgba(185, 75, 100, 0.7)',
                'rgba(185, 75, 100, 0.7)',
            ],
            borderColor: [
                'rgba(23, 23, 23, 0.8)',
                'rgba(23, 23, 23, 0.8)',
                'rgba(23, 23, 23, 0.8)',
                'rgba(23, 23, 23, 0.8)',
                'rgba(23, 23, 23, 0.8)',
                'rgba(23, 23, 23, 0.8)',
                'rgba(23, 23, 23, 0.8)',
                'rgba(23, 23, 23, 0.8)',
                'rgba(23, 23, 23, 0.8)',
                'rgba(23, 23, 23, 0.8)',
                'rgba(23, 23, 23, 0.8)',
                'rgba(23, 23, 23, 0.8)'
            ],
            borderWidth: 2,
            yAxisID: 'y-axis-1',
        }, {
            type: "line",
            borderColor: 'rgba(255, 255, 255, 0.8)',
            label: 'Time per month in hours',
            data: {{ time_episodes_watched }},
            borderWidth: 2,
            yAxisID: 'y-axis-2',
        }]
    },
    options: {
        legend: {
            labels: {
                fontColor: "#CCC",
            }
        },
        scales: {
            yAxes: [{
                position: 'left',
				id: 'y-axis-1',
                ticks: {
                    beginAtZero: true,
                    fontColor: "#CCC",
                    suggestedMax: {{ max_value }},
                },
                gridLines: {
                    display: true,
					drawBorder: true,
                    color: "rgba(255, 255, 255, 0.2)",
                }
            }, {
                position: 'right',
				id: 'y-axis-2',
                ticks: {
                    beginAtZero: true,
                    fontColor: "#CCC",
                },
            }],
            xAxes: [{
                ticks: {
                    fontColor: "#CCC",
                },
                gridLines: {
                    display: true,
					drawBorder: true,
                    color: "rgba(255, 255, 255, 0.2)",
                }
            }],
        }
    }
}); */
</script>
{% endblock %}

<!---->