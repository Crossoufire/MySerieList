{% extends "layout.html" %}


{% block css %}
<!-------- Principal CSS --------->
<style>
.container-form {
    max-width: 500px;
}

.account-img {
    height: 150px;
    width: 150px;
    margin-bottom: 15px;
    border-style: solid;
    border-width: 1px;
}

hr {
    border-top: 1px solid rgba(255, 255, 255, 0.9);
}

.form-control {
    background: transparent;
    border-radius: 0px;
    border-top: 0px;
    border-left: 0px;
    border-right: 0px;
    color: #fff;
}

.form-control:focus {
    background: transparent;
    border-radius: 0px;
    border-top: 0px;
    border-left: 0px;
    border-right: 0px;
    box-shadow: 0 0 0 0rem;
    color: #fff;
}

.form-check-label {
    margin-bottom: 30px;
}

.form_account {
    max-width: 800px;
}

.border_account {
    border-style: solid;
    border-width: 2px;
    border-color: grey;
    border-radius: 10px;
    padding-top: 30px;
    padding-bottom: 20px;
    padding-left: 50px;
    padding-right: 50px;
    margin-bottom: 20px;
}
</style>
{% endblock css %}


{% block content %}
<div class="container form_account">
    <div class="border_account">
        <!------------------------ Account picture/Username/Privacy -------------------------->
        <div class="d-flex flex-wrap-reverse">
            <div class="p-r-10 bd-highlight">
                <img class="rounded border-light account-img" src="{{ image_file }}">
            </div>
            <div class="bd-highlight">
                <h2 class="mt-0 account-heading">{{ current_user.username }}</h2>
                <span style="font-size: 14pt;">{{ current_user.email }}</span>
            </div>
            <div class="ml-auto bd-highlight text-center">
                {% if value_privacy == "checked" %}
                <a id="private_id" class="fas fa-2x fa-toggle-on" onclick="private_mode()"></a>
                <br>
                <span id="text_privacy">Private Mode On</span>
                {% else %}
                <a id="private_id" class="fas fa-2x fa-toggle-off" onclick="private_mode()"></a>
                <br>
                <span id="text_privacy">Private Mode Off</span>
                {% endif %}
            </div>
        </div>

        <!---------------------------- Account info/default page ----------------------------->
        <h3 class="font-weight-light text-center mt-4 mb-0">
            Account Info
            <div class="arrow_div float-right">
                <a class="fas fa-xs fa-chevron-down" id="INFO_arrow" onclick="hide('INFO', 'INFO_arrow')"></a>
            </div>
        </h3>
        <hr class="mt-2 mb-3">
        <div id="INFO" class="d-flex flex-wrap">
            <div class="col text-center">
                <span>Default home page:</span>
                <select id="home_page" class="ml-auto mr-auto m-t-10 m-b-20 scrollable-menu form-control text-center" style="max-width: 150px;">
                {% if home_page == "account" %}
                    <option selected="selected">Account</option>
                    <option>Hall of Fame</option>
                    <option>MySeriesList</option>
                    <option>MyAnimesList</option>
                    <option>MyBooksList</option>
                {% elif home_page == "hall_of_fame" %}
                    <option>Account</option>
                    <option selected="selected">Hall of Fame</option>
                    <option>MySeriesList</option>
                    <option>MyAnimesList</option>
                    <option>MyBooksList</option>
                {% elif home_page == "myserieslist" %}
                    <option>Account</option>
                    <option>Hall of Fame</option>
                    <option selected="selected">MySeriesList</option>
                    <option>MyAnimesList</option>
                    <option>MyBooksList</option>
                {% elif home_page == "myanimeslist" %}
                    <option>Account</option>
                    <option>Hall of Fame</option>
                    <option>MySeriesList</option>
                    <option selected="selected">MyAnimesList</option>
                    <option>MyBooksList</option>
                {% elif home_page == "mybookslist" %}
                    <option>Account</option>
                    <option>Hall of Fame</option>
                    <option>MySeriesList</option>
                    <option>MyAnimesList</option>
                    <option selected="selected">MyBooksList</option>
                {% endif %}
            </select>
            </div>
            <div class="d-flex flex-wrap">
                <form method="POST" action="" enctype="multipart/form-data">
                    {{ form.hidden_tag() }}
                    <div class="container-form">
                        <div class="form-group">
                            {{ form.username.label(class="form-control-label") }}
                            {% if form.username.errors %}
                                {{ form.username(class="form-control form-control is-invalid") }}
                                <div class="invalid-feedback">
                                    {% for error in form.username.errors %}
                                        <span>{{ error }}</span>
                                    {% endfor %}
                                </div>
                            {% else %}
                                {{ form.username(class="form-control form-control") }}
                            {% endif %}
                        </div>
                        <div class="form-group">
                            {{ form.email.label(class="form-control-label") }}
                            {% if form.email.errors %}
                                {{ form.email(class="form-control form-control is-invalid") }}
                                <div class="invalid-feedback">
                                    {% for error in form.email.errors %}
                                        <span>{{ error }}</span>
                                    {% endfor %}
                                </div>
                            {% else %}
                                {{ form.email(class="form-control form-control") }}
                            {% endif %}
                        </div>
                        <div class="form-group">
                            {{ form.picture.label() }}
                            {{ form.picture(class="form-control-file") }}
                            {% if form.picture.errors %}
                                {% for error in form.picture.errors %}
                                    <span class="text-danger">{{ error }}</span><br>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>
                    <div class="text-center">
                        {{ form.submit(class="btn btn-outline-info") }}
                        <a class="btn btn-outline-info" href="{{ url_for('change_password') }}" role="button">Change password?</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock content %}


{% block script %}
<!-------- Principal JS --------->
<script>
let home_page = document.getElementById("home_page");


home_page.onchange = function () {
    let selected_index = home_page.selectedIndex;
    $body = $("body");
    $.ajax ({
        type: "POST",
        url: "/default_page",
        contentType: "application/json",
        data: JSON.stringify({home_page: selected_index }),
        dataType: "json",
        beforeSend: function() { $body.addClass("loading"); },
        success: function(response) {
            $body.removeClass("loading"); }
    });
}


function private_mode() {
    var private = document.getElementById("private_id");

    if (private.className === "fas fa-2x fa-toggle-on") {
        private.className = "fas fa-2x fa-toggle-off";
        $('#text_privacy').text('Private Mode Off');
        $.ajax ({
            type: "POST",
            url: "/private_mode",
            contentType: "application/json",
            data: JSON.stringify({private: "off"}),
            dataType: "json",
            success: function(response) {
                console.log("off"); }
        });
    } else {
        private.className = "fas fa-2x fa-toggle-on";
        $('#text_privacy').text('Private Mode On');
        $.ajax ({
            type: "POST",
            url: "/private_mode",
            contentType: "application/json",
            data: JSON.stringify({private: "on"}),
            dataType: "json",
            success: function(response) {
                console.log("on"); }
        });
    }
}
</script>
<!------- Hide function --------->
<script>
function hide(category, arrow) {
    var category = document.getElementById(category);
    var arrow = document.getElementById(arrow);

    if (category.className === "d-flex flex-wrap"){
        category.className = "d-none";
        arrow.className = "fas fa-xs fa-chevron-right";
    } else {
        category.className = "d-flex flex-wrap";
        arrow.className = "fas fa-xs fa-chevron-down";
    }
}
</script>
{% endblock script %}