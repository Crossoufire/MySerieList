{% extends "layout.html" %}

{% block css %}
<!------ MDBootstrap Datatables ------->
<link href="{{ url_for('static', filename='css/datatables.min.css') }}" rel="stylesheet">
<!----------- Main CSS ----------->
<style>
table.dataTable thead .sorting:after,
table.dataTable thead .sorting:before,
table.dataTable thead .sorting_asc:after,
table.dataTable thead .sorting_asc:before,
table.dataTable thead .sorting_asc_disabled:after,
table.dataTable thead .sorting_asc_disabled:before,
table.dataTable thead .sorting_desc:after,
table.dataTable thead .sorting_desc:before,
table.dataTable thead .sorting_desc_disabled:after,
table.dataTable thead .sorting_desc_disabled:before {
    bottom: .5em;
}

.table {
  color: #fff
}

table.table a {
    color: #359aff;
}

.table td {
    text-align: center;
    vertical-align: middle;
}

.table tr {
    text-align: center;
    vertical-align: middle;
}

.current_user {
    background-color: #2c3946;
}

a.page-link {
    color: #ffffff !important;
}

hr {
    border-top: 1px solid rgba(255, 255, 255, 0.9)
}

.arrow_div {
    height: 21px;
    width: 21px;
}
</style>
{% endblock css %}


{% block content %}
<div class="container p-0">
    <table id="hall_of_fame" class="table table-striped table-sm table-responsive-lg" cellspacing="0" width="100%">
        <thead>
            <tr>
                <th></th>
                <th class="th-sm">Username</th>
                <th class="th-sm">Series</th>
                <th class="th-sm">Animes</th>
                <th class="th-sm">Books</th>
                <th class="th-sm">Total</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
        {% for user in all_data %}
            <tr>
            {% if current_user.get_id() == '1' %}
                <td>
                    <img src="{{ user['profile_picture'] }}" alt="{{ user['username'] }}" style="width: 40px; height: 40px;">
                </td>
                <td>
                    <b><a href="/account/{{ user['username'] }}">{{ user["username"] }}</a></b>
                </td>
                <td>
                    <img src="static/img/Ranks/{{user['series'][4][0][0] }}.ico" alt="{{ user['series'][4][0][1] }}" style="width: 30px; height: 30px;">
                    <br>
                    Level {{ user['series'][3][0] }} ({{ user['series'][3][1] }}%)
                </td>
                <td>
                    <img src="/static/img/Ranks/{{ user['animes'][4][0][0] }}.ico" alt="{{ user['animes'][4][0][1] }}" style="width: 30px; height: 30px;">
                    <br>
                    Level {{ user['animes'][3][0] }} ({{ user['animes'][3][1] }}%)
                </td>
                <td>
                    <img src="/static/img/Ranks/{{ user['books'][4][0][0] }}.ico" alt="{{ user['books'][4][0][1] }}" style="width: 30px; height: 30px;">
                    <br>
                    Level {{ user['books'][3][0] }} ({{ user['books'][3][1] }}%)
                </td>
                <td>
                    <img src="/static/img/Original/{{ user['total'][1][0][0] }}.png" alt="{{ user['total'][1][0][1] }}" style="width: 30px; height: 30px;">
                    <br>
                    Level {{ user['total'][0] }}
                </td>
                <td></td>

            {% elif user["iscurrentuser"] %}
                <td class="current_user">
                    <img src="{{ user['profile_picture'] }}" alt="{{ user['username'] }}" style="width: 40px; height: 40px;">
                </td>
                <td class="current_user">
                    <b><a href="/account/{{ user['username'] }}">{{ user["username"] }}</a></b>
                </td>
                <td class="current_user">
                    <img src="/static/img/Ranks/{{ user['series'][4][0][0] }}.ico" alt="{{ user['series'][4][0][1] }}" style="width: 30px; height: 30px;">
                    <br>
                    Level {{ user['series'][3][0] }} ({{ user['series'][3][1] }}%)
                </td>
                <td class="current_user">
                    <img src="/static/img/Ranks/{{ user['animes'][4][0][0] }}.ico" alt="{{ user['animes'][4][0][1] }}" style="width: 30px; height: 30px;">
                    <br>
                    Level {{ user['animes'][3][0] }} ({{ user['animes'][3][1] }}%)
                </td>
                <td class="current_user">
                    <img src="/static/img/Ranks/{{ user['books'][4][0][0] }}.ico" alt="{{ user['books'][4][0][1] }}" style="width: 30px; height: 30px;">
                    <br>
                    Level {{ user['books'][3][0] }} ({{ user['books'][3][1] }}%)
                </td >
                <td class="current_user">
                    <img src="/static/img/Original/{{ user['total'][1][0][0] }}.png" alt="{{ user['total'][1][0][1] }}" style="width: 30px; height: 30px;">
                    <br>
                    Level {{ user['total'][0] }}
                </td>
                <td class="current_user"></td>

            {% elif user["isprivate"] and not user["isfriend"] %}
                <td>
                    <img src="{{ url_for('static', filename='profile_pics/anonymous.jpg') }}" alt="Anonymous" style="width: 40px; height: 40px;">
                </td>
                <td>
                    <b>Anonymous</b>
                </td>
                <td>
                    <img src="/static/img/Ranks/{{ user['series'][4][0][0] }}.ico" alt="{{ user['series'][4][0][1] }}" style="width: 30px; height: 30px;">
                    <br>
                    Level {{ user['series'][3][0] }} ({{ user['series'][3][1] }}%)
                </td>
                <td>
                    <img src="/static/img/Ranks/{{ user['animes'][4][0][0] }}.ico" alt="{{ user['animes'][4][0][1] }}" style="width: 30px; height: 30px;">
                    <br>
                    Level {{ user['animes'][3][0] }} ({{ user['animes'][3][1] }}%)
                </td>
                <td>
                    <img src="/static/img/Ranks/{{ user['books'][4][0][0] }}.ico" alt="{{ user['books'][4][0][1] }}" style="width: 30px; height: 30px;">
                    <br>
                    Level {{ user['books'][3][0] }} ({{ user['books'][3][1] }}%)
                </td>
                <td>
                    <img src="/static/img/Original/{{ user['total'][1][0][0] }}.png" alt="{{ user['total'][1][0][1] }}" style="width: 30px; height: 30px;">
                    <br>
                    Level {{ user['total'][0] }}
                </td>
                <td></td>

            {% else %}
                <td>
                    <img src="{{ user['profile_picture'] }}" alt="{{ user['username'] }}" style="width: 40px; height: 40px;">
                </td>
                <td>
                    <b><a href="/account/{{ user['username'] }}">{{ user['username'] }}</a></b>
                </td>
                <td>
                    <img src="/static/img/Ranks/{{ user['series'][4][0][0] }}.ico" alt="{{ user['series'][4][0][1] }}" style="width: 30px; height: 30px;">
                    <br>
                    Level {{ user['series'][3][0] }} ({{ user['series'][3][1] }}%)
                </td>
                <td>
                    <img src="/static/img/Ranks/{{ user['animes'][4][0][0] }}.ico" alt="{{ user['animes'][4][0][1] }}" style="width: 30px; height: 30px;">
                    <br>
                    Level {{ user['animes'][3][0] }} ({{ user['animes'][3][1] }}%)
                </td>
                <td>
                    <img src="/static/img/Ranks/{{ user['books'][4][0][0] }}.ico" alt="{{ user['books'][4][0][1] }}" style="width: 30px; height: 30px;">
                    <br>
                    Level {{ user['books'][3][0] }} ({{ user['books'][3][1] }}%)
                </td>
                <td>
                    <img src="/static/img/Original/{{ user['total'][1][0][0] }}.png" alt="{{ user['total'][1][0][1] }}" style="width: 30px; height: 30px;">
                    <br>
                    Level {{ user['total'][0] }}
                </td>

                {% if user["isfriend"] %}
                    <td><i class="fas fa-user-friends"></i></td>
                {% elif user["ispendingfriend"] %}
                    <td><i class="fas fa-user-friends" style="color: #2c3946;"></i></td>
                {% else %}
                    <td><a class="fas fa-user-plus" onclick="add_friend('{{ user['username'] }}')"></a></td>
                {% endif %}
            {% endif %}
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endblock content %}


{% block script %}
<!--------- MDBootstrap Datatables ----------->
<script type="text/javascript" src="{{ url_for('static', filename='js/datatables.min.js') }}"></script>
<!-------------- Main JS ---------------->
<script>
function add_friend(username) {
    $body = $("body");
    $.ajax ({
        type: "POST",
        url: "/add_friend_hof",
        contentType: "application/json",
        data: JSON.stringify({user_name: username}),
        dataType: "json",
        beforeSend: function() { $body.addClass("loading"); },
        success: function(response) {
            window.location.replace('/hall_of_fame'); }
    });
}

$(document).ready(function () {
    $('#hall_of_fame').DataTable({
        "order": [[ 5, "desc" ], [ 1, "asc" ]],
        columnDefs: [{orderable: false, targets: 0},
                     {orderable: false, targets: 6}
                    ]
    });
    $('.dataTables_length').addClass('bs-select');
});
</script>
{% endblock script %}

